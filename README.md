# Image Manager

Автоматизация сборки и тестирования образов ОС для OpenStack.

Система собирает образ (qcow2), загружает его в Glance, создает тестовую VM и проверяет её работоспособность с помощью встроенного агента.

## Архитектура

Проект работает в кластере Kubernetes (K3s).

*   **Image Manager:** Веб-интерфейс и API (Go). Управляет сборкой.
*   **Disk Image Builder:** Утилита для сборки образов (запускается внутри пода).
*   **Agent:** Микросервис (Go), внедряемый в образ. Рапортует о состоянии VM.
*   **Jenkins:** CI/CD пайплайн. Собирает Docker-образ приложения и деплоит в K8s.
*   **Local Registry:** Хранилище Docker-образов внутри кластера.
*   **RabbitMQ:** Очередь сообщений (инфраструктурный компонент).

## Быстрый старт (Разработка)

### Локальный запуск (без K8s)
Требуется: Go 1.22+, Linux (для сборки образов), доступ к OpenStack.

1.  Создать `config.env` (см. `config.env.example`).
2.  Запустить:
    ```bash
    go run cmd/image-manager/main.go
    ```
3.  Интерфейс: http://localhost:8080

Подробнее см. [docs/DEV.md](docs/DEV.md).

## Деплой (Production / Stage)

Проект разворачивается в Kubernetes.
Используется K3s, Nginx Ingress, локальный Docker Registry.

Подробная инструкция по настройке сервера и кластера: [docs/DEPLOY_K8S.md](docs/DEPLOY_K8S.md).

## Структура репозитория

*   `cmd/` — Точки входа (сервер, агент).
*   `configs/distros/` — Конфигурации для сборки разных ОС (YAML).
*   `elements/` — Кастомные элементы disk-image-builder.
*   `internal/` — Логика приложения.
*   `k3s/` — Манифесты Kubernetes.
*   `web/` — Фронтенд (HTML/JS).
