# Ограничение доступа по IP с ответом 410 Gone
# Подключать через: include /etc/nginx/snippets/whitelist.conf;

# Переопределяем ошибку 403 (Forbidden) в 410 (Gone) для этого контекста
error_page 403 =410 @gone;

# === БЕЛЫЙ СПИСОК ===
allow 188.120.252.0/24;  # Офис / VPN
allow 172.16.0.0/12;     # Локальная сеть Docker / Private
allow 172.31.217.0/24;   # Специфичная подсеть
allow 10.0.0.0/24;       # Внутренняя сеть

# Всех остальных — блокируем (вернет 403, который превратится в 410)
deny all;

# Обработчик для "ушедших" гостей
location @gone {
    return 410 "Gone. The resource is no longer available here. Go away.";
    # Или просто: return 410;
}
