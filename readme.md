# Image Manager MVP

**Image Manager** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–±–ª–∞—á–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ (Cloud Images) –¥–ª—è OpenStack.
–û–Ω —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ –û–° —Å –Ω—É–ª—è, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –µ–≥–æ –≤ –æ–±–ª–∞–∫–æ, —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—ë 
—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é –≤–Ω–µ–¥—Ä–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ grpc –∏ —É–±–∏—Ä–∞–µ—Ç –∑–∞ —Å–æ–±–æ–π —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å


## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **–ú—É–ª—å—Ç–∏-–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–±–æ—Ä–∫–∏ (–ø–æ–∫–∞-—á—Ç–æ) **Debian 12** –∏ **Ubuntu 24.04**.
*   **–°–±–æ—Ä–∫–∞ (DIB):** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `disk-image-builder` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `.qcow2` –æ–±—Ä–∞–∑–æ–≤.
*   **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** Build -> Upload (Glance) -> Boot (Nova) -> Test -> Cleanup.
*   **gRPC –ê–≥–µ–Ω—Ç:** –í–Ω–µ–¥—Ä—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä—å –æ–±—Ä–∞–∑–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ç—å/–¥–∏—Å–∫–∏ –∏ —Ä–∞–ø–æ—Ä—Ç—É–µ—Ç –æ —Å—Ç–∞—Ç—É—Å–µ.
*   **Web Dashboard:**
    *   –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–æ–∫ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫.
    *   **Real-time –ª–æ–≥–∏** –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∫–∏.
    *   **–ò—Å—Ç–æ—Ä–∏—è —Å–±–æ—Ä–æ–∫** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ª–æ–≥–æ–≤ –≤ –ë–î.
    *   –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–∑–æ–≤ –≤ OpenStack Glance.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** Basic Auth (–ø–∞—Ä–æ–ª—å –≤ config.env, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, —Ç–∞–π–º–∞—É—Ç—ã.

---

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

*   **Go:** 1.22+
*   **Python:** 3.x (–¥–ª—è `disk-image-builder`)
*   **System Tools:** `qemu-utils`, `kpartx`

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç
sudo apt-get update
sudo apt-get install -y qemu-utils kpartx git

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ disk-image-builder
pip3 install diskimage-builder
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
git https://github.com/Dn4g/image-manager.git
cd image-manager
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `config.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞.
```bash
cp config.env.example config.env
nano config.env
```
**–í–∞–∂–Ω–æ:** –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è (OpenStack Credentials, Network ID, Flavor ID).
–¢–∞–∫–∂–µ —É–∫–∞–∂–∏—Ç–µ `HTTP_USERNAME` –∏ `HTTP_PASSWORD` –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

## üèóÔ∏è –°–±–æ—Ä–∫–∞ (Build)

–ü–æ—Å–∫–æ–ª—å–∫—É –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∏—Ö –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º.

### –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ –ê–≥–µ–Ω—Ç–∞
–ê–≥–µ–Ω—Ç ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç "–∂–∏—Ç—å" –≤–Ω—É—Ç—Ä–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤. –ï—ë –Ω—É–∂–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ Linux –∏ –ø–æ–ª–æ–∂–∏—Ç—å –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É, –æ—Ç–∫—É–¥–∞ `disk-image-builder` –µ—ë –∑–∞–±–µ—Ä–µ—Ç.

```bash
# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –∞–≥–µ–Ω—Ç–∞ –ø–æ–¥ Linux AMD64
GOOS=linux GOARCH=amd64 go build -o elements/agent-install/agent cmd/agent/main.go

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
chmod +x elements/agent-install/install.d/*
chmod +x elements/cloud-init-custom/install.d/*
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –°–µ—Ä–≤–µ—Ä–∞
```bash
# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
set -a; source config.env; set +a
go run cmd/image-manager/main.go
```

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8080`

---

## üñ•Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1.  –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8080`.
2.  –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å (–∏–∑ `config.env`).
3.  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"–û–±—Ä–∞–∑—ã"**.
4.  –í—ã–±–µ—Ä–∏—Ç–µ **Debian 12** –∏–ª–∏ **Ubuntu 24.04** –∏ –Ω–∞–∂–º–∏—Ç–µ **"–°–æ–±—Ä–∞—Ç—å"**.
5.  –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

### –í–∫–ª–∞–¥–∫–∏
*   **–û–±—Ä–∞–∑—ã:** –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö —Å–±–æ—Ä–æ–∫, —Å—Ç–∞—Ç—É—Å EOL.
*   **–°—Ç–µ–Ω–¥—ã:** –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –≤ –≤–∞—à–µ–º OpenStack –ø—Ä–æ–µ–∫—Ç–µ (Glance).
*   **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–∫–∞–∑–∞—Ç—å", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏ (stdout/stderr) –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∫–∏.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
image-manager/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ image-manager/      # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä (Backend)
‚îÇ   ‚îî‚îÄ‚îÄ agent/              # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ê–≥–µ–Ω—Ç–∞ (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ VM)
‚îú‚îÄ‚îÄ elements/               # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã disk-image-builder
‚îÇ   ‚îú‚îÄ‚îÄ agent-install/      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –∞–≥–µ–Ω—Ç–∞ –∏ systemd —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ cloud-init-custom/  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Cloud-Init (SSH, Users)
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ adapter/            # –ö–ª–∏–µ–Ω—Ç OpenStack (Gophercloud)
‚îÇ   ‚îú‚îÄ‚îÄ service/            # –õ–æ–≥–∏–∫–∞ —Å–±–æ—Ä–∫–∏ (Builder)
‚îÇ   ‚îú‚îÄ‚îÄ storage/            # –†–∞–±–æ—Ç–∞ —Å SQLite (–∏—Å—Ç–æ—Ä–∏—è, –ª–æ–≥–∏)
‚îÇ   ‚îú‚îÄ‚îÄ handler/            # HTTP API
‚îÇ   ‚îî‚îÄ‚îÄ server/grpc/        # gRPC —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ –æ—Ç –∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ web/                    # Frontend (HTML/JS/CSS)
‚îî‚îÄ‚îÄ config.env              # –í–∞—à–∏ —Å–µ–∫—Ä–µ—Ç—ã (–≤ .gitignore)
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

*   –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç: —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤–æ –≤–∫–ª–∞–¥–∫–µ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞".
*   –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–∏—à—É—Ç—Å—è –≤ `app.log`.