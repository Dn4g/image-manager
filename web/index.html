<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Image Manager Dashboard</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #eee; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #4af; }

        /* –§–æ—Ä–º–∞ –∑–∞–ø—É—Å–∫–∞ */
        .card { background: #333; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input, select, button { padding: 10px; margin-right: 10px; border: none; border-radius: 4px; }
        input { background: #444; color: white; }
        button { background: #4af; color: #111; cursor: pointer; font-weight: bold; }
        button:hover { background: #6cf; }

        /* –õ–æ–≥ –∫–æ–Ω—Å–æ–ª—å */
        #logs { background: #111; color: #0f0; padding: 10px; height: 150px; overflow-y: scroll; font-family: monospace; border-radius: 4px; margin-top: 20px;}
        .log-entry { border-bottom: 1px solid #222; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ Image Manager</h1>

    <div class="card">
        <h3>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫—É</h3>
        <input type="text" id="imgName" placeholder="–ò–º—è –æ–±—Ä–∞–∑–∞ (–Ω–∞–ø—Ä. test-v1)" value="test-image">
        <select id="distro">
            <option value="cirros">CirrOS (–ë—ã—Å—Ç—Ä–æ)</option>
            <option value="ubuntu-minimal">Ubuntu Minimal</option>
            <option value="debian">Debian</option>
        </select>
        <button onclick="startBuild()">üî• –°–æ–±—Ä–∞—Ç—å</button>
    </div>

    <div class="card">
        <h3>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π (Frontend)</h3>
        <div id="logs"></div>
    </div>
</div>

<script>
    const LOGS = document.getElementById('logs');

    function log(msg) {
        const div = document.createElement('div');
        div.className = 'log-entry';
        div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
        LOGS.prepend(div);
    }

    async function startBuild() {
        const name = document.getElementById('imgName').value;
        const distro = document.getElementById('distro').value;

        if (!name) return alert("–í–≤–µ–¥–∏ –∏–º—è!");

        log(`–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–±–æ—Ä–∫—É: ${name} (${distro})...`);

        try {
            const res = await fetch('/build', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ image_name: name, distro: distro })
            });

            if (!res.ok) {
                const txt = await res.text();
                throw new Error(txt);
            }

            const data = await res.json();
            log(`‚úÖ –£—Å–ø–µ—Ö! ID —Å–±–æ—Ä–∫–∏: ${data.build_id}. –°—Ç–∞—Ç—É—Å: ${data.status}`);
            log(`–¢–µ–ø–µ—Ä—å —Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (SSH), –ø–æ–∫–∞ —Ç—É—Ç –Ω–µ—Ç –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.`);

        } catch (e) {
            log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`);
        }
    }
</script>

</body>
</html>
